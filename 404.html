<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Redirecting...</title>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- 路由逻辑 ---
            // 1. 获取用户输入的完整URL路径，例如 "/download/raw/dudu.txt"
            const path = window.location.pathname;

            // 2. 定义我们的触发下载的路径前缀
            const DOWNLOAD_PREFIX = '/download/raw/';
            const PUBLIC_PREFIX = '/download/';

            // 3. 从URL中解析出你希望的下载文件名
            //    例如，从 "/download/raw/folder/file.txt" 中得到 "folder/file.txt"
            let targetFilePath = '';

            if (path.startsWith(DOWNLOAD_PREFIX)) {
                // 如果是下载路径
                targetFilePath = path.substring(DOWNLOAD_PREFIX.length);
                performDownload(targetFilePath);
            } else if (path.startsWith(PUBLIC_PREFIX) && !path.startsWith(DOWNLOAD_PREFIX)) {
                // 如果是公开访问路径 (不带/raw)
                targetFilePath = path.substring(PUBLIC_PREFIX.length);
                redirectToPublicFile(targetFilePath);
            } else {
                // 如果路径不匹配我们的规则，可以重定向到主页或显示一个空白页
                // window.location.href = '/'; // 或者保持空白
                console.log('Path not recognized. Staying on blank page.');
            }
        });

        /**
         * 执行文件下载
         * @param {string} filePath - 仓库内的文件路径，例如 "dudu.txt" 或 "assets/image.zip"
         */
        function performDownload(filePath) {
            // 构建GitHub Raw文件的绝对URL
            // 例如：https://raw.githubusercontent.com/dudu2024173/main/dudu.txt
            const rawUrl = `https://raw.githubusercontent.com/dudu2024173/main/${filePath}`;

            console.log(`Triggering download for: ${rawUrl}`);

            // 创建一个隐藏的<a>标签来触发浏览器下载
            const link = document.createElement('a');
            link.href = rawUrl;
            link.setAttribute('download', ''); // download属性提示浏览器下载而非导航
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            // 下载触发后，关闭当前标签页
            closeWindow();
        }
        
        /**
         * 重定向到公开的文件路径 (让用户在浏览器中查看，而非下载)
         * @param {string} filePath - 仓库内的文件路径
         */
        function redirectToPublicFile(filePath) {
            const publicUrl = `https://dudu2024173.github.io/${filePath}`;
            console.log(`Redirecting to public view: ${publicUrl}`);
            window.location.replace(publicUrl);
        }

        /**
         * 安全地关闭窗口
         */
        function closeWindow() {
            // setTimeout gives the download a moment to initiate before closing
            setTimeout(() => {
                window.close();
            }, 500);
        }
    </script>
</head>
<body>
    <!-- 页面保持空白 -->
</body>
</html>
